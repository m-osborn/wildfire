<!DOCTYPE html>
<html lang="en" class="fuelux">
<head>
    <meta charset="utf-8">
    <title>Project Wildfire</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="css/fuelux.css" rel="stylesheet">
    <link href="css/extend.css" rel="stylesheet">

    <script src="lib/require.js"></script>

    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBgedHYoAo_BFxAwpKEJq2PGrhBxN_1LZc&sensor=false"></script>

    <style type="text/css">


    </style>

    <script>
        requirejs.config({
            config: {
                moment: {
                    noGlobal: true
                }
            },
            paths: {
                jquery: 'lib/jquery-1.9.1.min',
                underscore: 'http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min',
                bootstrap: 'lib/bootstrap/js',
                fuelux: 'lib/fuelux',
                moment: 'lib/moment' // comment out if you dont want momentjs to be default
            },
            shim: {
                underscore: {
                    exports: '_'
                }
            }
        });

        require(['jquery', 'fuelux/all', 'underscore'], function ($, fuelux) {

            var postData = {
                map: {
                    latitude: 39.7683800,
                    longitude: -86.1580400,
                    radius: 1
                },
                keywords: []
            };

            var $wizard = $('#wiz');
            var $wizardButtonNext = $('#btnWizardNext');
            var $wizardButtonPrev = $('#btnWizardPrev');

            var $searchAddress = $('#search-address');
            var $radiusSpinner = $('#radius-spinner');
            var $keywordPillbox = $('#MyPillbox');
            var $noKeywordsStr = $('#no-keywords');
            var $addKeywordButton = $('#add-keyword-label button');


            // Address Search
            $searchAddress.on('searched', function(e, searchText) {
                if (searchText) {
                    var url = "https://maps.googleapis.com/maps/api/geocode/json"
                    $.ajax({
                        type: "GET",
                        url: url,
                        data: {
                            address: searchText.trim(),
                            sensor: false,
                            key: "AIzaSyBgedHYoAo_BFxAwpKEJq2PGrhBxN_1LZc"
                        },
                        dataType: "json",
                        success: function(data, textStatus, jqXHR) {
                            console.log(data);
                            if (data.status === "OK" && data.results && data.results.length) {
                                var locObj = data.results[0];
                                console.log("Lat: " + locObj.geometry.location.lat + ", Lng: " + locObj.geometry.location.lng);
                                var myLatlng = new google.maps.LatLng(locObj.geometry.location.lat, locObj.geometry.location.lng);
                                marker.setPosition(myLatlng);
                                map.setCenter(myLatlng);
                            } else {
                                console.log(data.error_message);
                            }
                        },
                        error: function(jqXHR, textStatus, errorThrown) {
                            console.log(errorThrown);
                        }
                    });
                }
                return false;
            });

            // Prints the post data to the console
            // THIS IS TEMPORARY
            $('#logPostData').on('click', function() {
                console.log(JSON.stringify(postData, null, 4));
            });


            // ----- Wizard ----------------------------------------------------

            $wizard.on('change', function(e, data) {
                // console.log('change'); // TEMP
                if(data.step === 3 && data.direction === 'next') {
                    return e.preventDefault();
                }
            });
            $wizard.on('changed', function(e, data) {
                console.log('changed');
            });
            $wizard.on('finished', function(e, data) {
                console.log('finished');
            });
            $wizard.on('stepclick', function(e, data) {
                console.log('step' + data.step + ' clicked');
                if(data.step === 1) {
                    // return e.preventDefault();
                }
            });


            // ----- Mapping view ----------------------------------------------

            // Die Landkarte
            var myLatlng = new google.maps.LatLng(39.7683800, -86.1580400)
            var mapOptions = {
                center: myLatlng,
                zoom: 11
            };
            var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
            var marker = new google.maps.Marker({
                position: myLatlng,
                map: map
            });

            google.maps.event.addListener(map, 'click', function(event) {
                postData.map.latitude = event.latLng.lat();
                postData.map.longitude = event.latLng.lng();
            });

            // Spinner
            $radiusSpinner.spinner({
                'value': 1,
                'min': 1,
                'max': 10
            });

            $radiusSpinner.on('changed', function (e, value) {
                postData.map.radius = value;
                console.log('Spinner changed: ', value); // TEMP
            });

            // Map search field
            $searchAddress.on('cleared', function() {
                console.log('Search Cleared.'); // TEMP
            });


            // ----- Keywords view ----------------------------------

            $addKeywordButton.on('click', function() {
                var $inputField = $('#add-keyword-field');
                var val = $inputField.val().trim();
                $inputField.val('');
                $keywordPillbox.pillbox('addItem', val, val);
            });

            var showOrHideNoKeywords = function() {
                var show = ($keywordPillbox.pillbox('items').length === 0) ? true : false;
                if (show) {
                    $noKeywordsStr.show();
                } else {
                    $noKeywordsStr.hide();
                }
            };

            $keywordPillbox.on('added', function(event, value) {
                postData.keywords.push(value.value);
                showOrHideNoKeywords();
            });
            $keywordPillbox.on('removed', function(event, value) {
                postData.keywords = _.without(postData.keywords, value.value);
                showOrHideNoKeywords();
            });
        });
    </script>


</head>

<body>

<div class="container">

    <!-- WIZARD -->
    <div>
        <div id="wiz" class="wizard">
            <ul class="steps">
                <li data-target="#step1" class="active"><span class="badge badge-info">1</span>Select Location<span class="chevron"></span></li>
                <li data-target="#step2"><span class="badge">2</span>Specify Keywords<span class="chevron"></span></li>
                <li data-target="#step3"><span class="badge">3</span>Confirmation<span class="chevron"></span></li>
            </ul>
            <div class="actions">
                <button id="btnWizardPrev" class="btn btn-mini btn-prev"> <i class="icon-arrow-left"></i>Prev</button>
                <button id="btnWizardNext" class="btn btn-mini btn-next" data-last="Finish">Next<i class="icon-arrow-right"></i></button>
            </div>
        </div>
        <div class="step-content">

            <!-- Google Map view -->
            <div class="step-pane active" id="step1">
                <div id="map-container" class="well google-maps">
                    <div id="map-canvas"></div>
                </div>

                <div class="map-sidebar well">
                    <div style="height: 40px;">
                        <div id="search-address" class="input-append search">
                            <input type="text" class="input-medium" placeholder="Search by Address"><button type="button" class="btn"><i class="icon-search"></i></button>
                        </div>
                        <div id="spinner-label" class="pull-left">
                            <label>Select Radius:</label>
                            <div id="label-desc">(value is in miles)</div>
                        </div>

                        <div id="radius-spinner" class="spinner pull-right">
                            <input type="text" class="input-mini spinner-input">

                            <div class="spinner-buttons  btn-group btn-group-vertical">
                                <button class="btn spinner-up">
                                    <i class="icon-chevron-up"></i>
                                </button>
                                <button class="btn spinner-down">
                                    <i class="icon-chevron-down"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Keyword entry view -->
            <div class="step-pane" id="step2">
                <div id="MyPillbox" class="pillbox">
                    <div id="no-keywords">no keywords yet!</div>
                    <ul>
                    </ul>
                </div>
                <div id="add-keyword-label" class="pull-left">
                    <input type="text" id="add-keyword-field">
                    <button class="btn btn-primary" type="button">Add Keyword</button>
                </div>
            </div>


            <!-- Confirmation view -->
            <div class="step-pane" id="step3">
                Confirm
            </div>
        </div>

        <input type="button" class="btn btn-mini" id="logPostData" value="log post data">
    </div>


</div>

</body>
</html>
